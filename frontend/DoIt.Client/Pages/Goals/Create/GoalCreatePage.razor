@page "/goals/create"

@using DoIt.Client.Components.Loading
@using DoIt.Client.Models.Goals;
@using DoIt.Client.Models.Menus
@using DoIt.Client.Services.Goals;
@using DoIt.Client.Components.Fields;
@using DoIt.Client.Components.Buttons;
@using DoIt.Client.Models.General
@using DoIt.Client.Models.Icons
@using DoIt.Client.Services.Modals
@using DoIt.Interface.Goals
@using Microsoft.AspNetCore.Components

@inherits BaseModalComponent<GoalCreateParameter>

@inject IGoalService GoalService;
@inject ModalService ModalService;


<DoIt.Client.Components.Modals.ModalComponent Title="Create Goal" CloseModal="() => ModalService.Close()" Options="Options">
    <Content>
        <LoadingContainerComponent LoadingState="LoadingState">
            <Rendered>
                <article class="goal-detail">
                    <DoIt.Client.Components.Goals.GoalFormComponent Goal="Goal">
                    </DoIt.Client.Components.Goals.GoalFormComponent>
                </article>
            </Rendered>
        </LoadingContainerComponent>
    </Content>
</DoIt.Client.Components.Modals.ModalComponent>

@code {
    public Models.Goals.GoalFormDto Goal = new Models.Goals.GoalFormDto()
        {
            DueAt = DateTime.Now
        };

    public IEnumerable<MenuOption> Options { get; set; }


    //private List<string> options = ((GoalType[])Enum.GetValues(typeof(GoalType))).Select(t => t.ToString()).ToList();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        Options = new List<MenuOption>()
        {
            new MenuOption()
            {
                Title = "Create",
                Icon = Models.Icons.IconType.Delete,
                OnClick = async () => await this.CreateGoalAsync(Goal),
                DefaultActive = true
            },
        };

        //Console.WriteLine(JsonConvert.SerializeObject(Parameter));
        //if (Parameter != null && Parameter.Idea != null)
        //{
        //	this.NewGoal.IdeaId = Parameter.Idea.Id;
        //	this.NewGoal.Title = Parameter.Idea.Title;
        //	this.NewGoal.Description = Parameter.Idea.Description;
        //}
    }

    private async Task CreateGoalAsync(GoalFormDto goal)
    {
        var response = await GoalService.CreateGoalAsync(goal.ToService());

        CloseModal(ActionType.Create, response);
    }
}
